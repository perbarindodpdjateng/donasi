<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rekap Peserta Realtime</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root {
      /* Warna Modern - Glassmorphism & Neumorphism blend */
      --clr-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --clr-card: rgba(255, 255, 255, 0.95);
      --clr-glass: rgba(255, 255, 255, 0.2);
      --clr-line: rgba(255, 255, 255, 0.3);
      --clr-text: #1f2937;
      --clr-subtle: #6b7280;
      --clr-accent: #4f46e5;
      --clr-accent-hover: #4338ca;
      --radius: 12px;
      --shadow-soft: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
      --shadow-medium: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
      
      /* UKURAN HURUF KOMPAK TAPI NYAMAN */
      --font-base: clamp(11px, 1.8vw, 14px);
      --font-xs: 0.75em;
      --font-sm: 0.85em;
      --font-main: 1em;
      --font-lg: 1.15em;
      --font-xl: 1.4em;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--clr-bg);
      background-attachment: fixed;
      color: var(--clr-text);
      font-size: var(--font-base);
      min-height: 100vh;
      padding: 4px;
      line-height: 1.4;
    }

    /* ---------- HERO MODERN ---------- */
    .hero {
      background: var(--clr-glass);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid var(--clr-line);
      border-radius: var(--radius);
      box-shadow: var(--shadow-medium);
      text-align: center;
      padding: 12px 8px;
      margin: 0 auto 6px;
      max-width: 600px;
      position: relative;
      overflow: hidden;
    }
    
    .hero::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: shimmer 8s infinite linear;
    }
    
    @keyframes shimmer {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .hero__title {
      font-size: var(--font-lg);
      font-weight: 700;
      color: #fff;
      line-height: 1.3;
      margin-bottom: 4px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: relative;
      z-index: 1;
    }
    .hero__title span {
      font-size: var(--font-sm);
      font-weight: 500;
      color: rgba(255,255,255,0.85);
      display: block;
      margin-top: 2px;
    }
    .hero__total {
      font-size: var(--font-xl);
      font-weight: 700;
      color: #fff;
      margin-bottom: 2px;
      position: relative;
      z-index: 1;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .hero__donatur {
      font-size: var(--font-main);
      font-weight: 600;
      color: rgba(255,255,255,0.9);
      margin-bottom: 12px;
      position: relative;
      z-index: 1;
    }

    /* ---------- TOMBOL 3D MODERN ---------- */
    .hero__btn-container {
      position: relative;
      z-index: 1;
      perspective: 1000px;
      display: inline-block;
    }
    
    .hero__btn {
      display: inline-block;
      padding: 0.9em 1.8em;
      font-size: var(--font-sm);
      font-weight: 600;
      color: #fff;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 50px;
      text-decoration: none;
      cursor: pointer;
      position: relative;
      transform-style: preserve-3d;
      transform: translateZ(0);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 10px 20px rgba(102, 126, 234, 0.4),
        0 6px 6px rgba(102, 126, 234, 0.3),
        inset 0 2px 0 rgba(255,255,255,0.2),
        inset 0 -2px 0 rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    /* Efek shine/glossy */
    .hero__btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.6s;
    }
    
    /* Efek pulse/glow di belakang */
    .hero__btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      height: 100%;
      border-radius: 50px;
      background: inherit;
      opacity: 0;
      z-index: -1;
      transition: all 0.4s;
    }

    .hero__btn:hover {
      transform: translateY(-3px) translateZ(20px) rotateX(5deg);
      box-shadow: 
        0 20px 40px rgba(102, 126, 234, 0.5),
        0 15px 15px rgba(102, 126, 234, 0.4),
        inset 0 2px 0 rgba(255,255,255,0.3),
        inset 0 -2px 0 rgba(0,0,0,0.1);
    }
    
    .hero__btn:hover::before {
      left: 100%;
    }
    
    .hero__btn:hover::after {
      opacity: 0.4;
      transform: translate(-50%, -50%) scale(1.2);
      filter: blur(10px);
    }

    .hero__btn:active {
      transform: translateY(-1px) translateZ(10px) rotateX(2deg);
      box-shadow: 
        0 5px 10px rgba(102, 126, 234, 0.4),
        inset 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Floating animation */
    @keyframes float {
      0%, 100% { transform: translateY(0) translateZ(0); }
      50% { transform: translateY(-5px) translateZ(10px); }
    }
    
    .hero__btn-container {
      animation: float 4s ease-in-out infinite;
    }
    
    .hero__btn-container:hover {
      animation-play-state: paused;
    }

    /* ---------- CARD MODERN ---------- */
    .card {
      background: var(--clr-card);
      border-radius: var(--radius);
      box-shadow: var(--shadow-medium);
      padding: 8px;
      max-width: 600px;
      margin: auto;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.5);
    }

    .search-box {
      position: relative;
      margin-bottom: 6px;
    }
    .search-box input {
      width: 100%;
      font-size: var(--font-sm);
      padding: 0.5em 2.2em 0.5em 0.7em;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      outline: none;
      background: #f9fafb;
      transition: all 0.2s;
    }
    .search-box input:focus { 
      border-color: var(--clr-accent);
      background: #fff;
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }
    
    .search-box::after {
      content: 'üîç';
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: var(--font-xs);
      opacity: 0.5;
    }

    /* ---------- TABEL KOMPAK ---------- */
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      font-size: var(--font-xs);
    }
    th, td {
      padding: 0.35em 0.4em;
      border-bottom: 1px solid #f3f4f6;
      line-height: 1.3;
      vertical-align: middle;
    }
    th {
      background: linear-gradient(to bottom, #f9fafb, #f3f4f6);
      font-weight: 600;
      color: #374151;
      position: sticky;
      top: 0;
      z-index: 1;
      font-size: var(--font-xs);
      text-transform: uppercase;
      letter-spacing: 0.02em;
      border-bottom: 2px solid #e5e7eb;
    }
    tr:last-child td {
      border-bottom: none;
    }
    
    /* Lebar kolom yang proporsional - Kolom 4 disembunyikan */
    th:nth-child(1), td:nth-child(1) { width: 18%; min-width: 70px; text-align: center; font-weight: 600; }
    th:nth-child(2), td:nth-child(2) { width: 55%; }
    th:nth-child(3), td:nth-child(3) { width: 27%; text-align: right; font-weight: 500; }
    th:nth-child(4), td:nth-child(4) { display: none; } /* Kolom ke-4 disembunyikan */

    tr:hover td {
      background: #f9fafb;
      transition: background 0.15s;
    }

    tr.new-entry td { 
      background: linear-gradient(90deg, #dcfce7, #f0fdf4);
      animation: slideIn 0.6s ease-out;
      border-left: 3px solid #22c55e;
    }
    @keyframes slideIn { 
      from { 
        opacity: 0; 
        transform: translateX(-10px);
        background: #bbf7d0;
      } 
      to { 
        opacity: 1; 
        transform: translateX(0);
        background: linear-gradient(90deg, #dcfce7, #f0fdf4);
      } 
    }

    .loading, .warning {
      text-align: center;
      margin-bottom: 4px;
      font-size: var(--font-sm);
      padding: 8px;
    }
    .loading { 
      color: var(--clr-subtle);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .loading::before {
      content: '';
      width: 14px;
      height: 14px;
      border: 2px solid #e5e7eb;
      border-top-color: var(--clr-accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .warning { 
      color: #ef4444; 
      background: #fef2f2;
      border-radius: 6px;
      border: 1px solid #fecaca;
    }

    /* ---------- PAGINATION ---------- */
    .pagination{
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      padding-top: 6px;
      border-top: 1px solid #f3f4f6;
      font-size: var(--font-xs);
    }
    .pagination button{
      padding: 0.35em 0.8em;
      border: 1px solid #e5e7eb;
      background: #fff;
      border-radius: 6px;
      cursor: pointer;
      font-size: var(--font-xs);
      font-weight: 500;
      color: #374151;
      transition: all 0.2s;
      box-shadow: var(--shadow-soft);
    }
    .pagination button:hover:not(:disabled){
      background: #f9fafb;
      border-color: #d1d5db;
      transform: translateY(-1px);
      box-shadow: var(--shadow-medium);
    }
    .pagination button:disabled{
      opacity: 0.4;
      cursor: not-allowed;
      background: #f3f4f6;
    }
    .pagination span {
      color: #6b7280;
      font-weight: 500;
    }

    /* ---------- RESPONSIVE ---------- */
    @media (max-width: 360px) {
      :root { --font-base: clamp(10px, 2vw, 12px); }
      th, td { padding: 0.3em 0.35em; }
      .hero { padding: 10px 6px; }
    }
    
    @media (min-width: 768px) {
      body { padding: 8px 12px; }
      .hero { padding: 16px 12px; }
      .card { padding: 12px; }
    }
  </style>
</head>

<body>
  <!-- HERO / BANNER -->
  <section id="hero" class="hero">
    <h1 class="hero__title">
      LAPORAN PENYAMPAIAN DONASI BENCANA ALAM<br>
      Sumatera Utara, Sumatera Barat & Aceh<br>
      <span>PERBARINDO ‚Äì BPR/BPRS PEDULI</span>
    </h1>
    <p id="heroTotal" class="hero__total">Total Donasi: Rp 0</p>
    <p id="heroDonatur" class="hero__donatur">Total Donatur: 0</p>
    <div class="hero__btn-container">
      <a class="hero__btn" href="https://www.perbarindodpdjateng.or.id/donasi/s/L" target="_blank">
        INFO LENGKAP PENYAMPAIAN DONASI
      </a>
    </div>
  </section>

  <div class="card">
    <p id="loading" class="loading">Memuat data...</p>

    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Cari Donatur / Donasi"/>
    </div>

    <table id="dataTable">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const rowsPerPage = 5;
    let currentPage   = 1;
    let previousData  = '';
    let lastRendered  = [];
    let originalData  = [];

    function formatDateOnly(str) {
      if (!str || typeof str !== 'string') return str;
      const d = new Date(str);
      if (isNaN(d.getTime())) return str;
      const pad = n => String(n).padStart(2, '0');
      return `${pad(d.getDate())}/${pad(d.getMonth()+1)}/${String(d.getFullYear()).slice(-2)}`;
    }

    function isDateString(str) {
      return typeof str === 'string' && /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/.test(str);
    }

    function formatRibuan(raw) {
      if (isNaN(raw) || raw === '') return raw;
      return Number(raw).toLocaleString('id-ID');
    }

    function hitungTotalDonasi() {
      if (!originalData.length) return 0;
      return originalData.slice(1).reduce((sum, row) => {
        const val = Number(row[2]);
        return sum + (isNaN(val) ? 0 : val);
      }, 0);
    }

    function tampilkanTotal() {
      const nominal = formatRibuan(hitungTotalDonasi());
      const donatur = originalData.length - 1;
      document.getElementById('heroTotal').textContent   = 'Total Donasi: Rp ' + nominal;
      document.getElementById('heroDonatur').textContent = 'Total Donatur: ' + donatur;
    }

    async function fetchData() {
      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbyG1IWKek6-2NPlaUFHCi3TL6_aULRxUXoX9aWxNrCUUFi4FoiiebWBOPHcEE7eOb4n/exec', {
          cache: 'no-store'
        });
        const data = await response.json();
        const dataString = JSON.stringify(data);

        if (dataString !== previousData) {
          previousData = dataString;
          originalData = data;
          currentPage  = 1;
          tampilkanTotal();
          renderTable();
        }
        document.getElementById("loading").style.display = "none";
      } catch (error) {
        console.error("Fetch error:", error);
        document.getElementById("loading").textContent = "Gagal memuat data.";
        document.getElementById("loading").className = "warning";
      }
    }

    function renderTable() {
      const search = document.getElementById("searchInput").value.toLowerCase();
      let filtered = originalData.filter((row, idx) => {
        if (idx === 0) return true;
        return row.join(" ").toLowerCase().includes(search);
      });

      const header   = filtered[0];
      const bodyRows = filtered.slice(1);
      const totalPg  = Math.max(1, Math.ceil(bodyRows.length / rowsPerPage));

      if (currentPage > totalPg) currentPage = totalPg;

      const start    = (currentPage - 1) * rowsPerPage;
      const end      = start + rowsPerPage;
      const pageRows = [header, ...bodyRows.slice(start, end)];

      renderTablePage(pageRows);
      renderPagination(totalPg);
    }

    function renderTablePage(pageRows) {
      const thead = document.querySelector("#dataTable thead");
      const tbody = document.querySelector("#dataTable tbody");
      thead.innerHTML = "";
      tbody.innerHTML = "";

      pageRows.forEach((row, index) => {
        const tr = document.createElement("tr");

        if (index !== 0) {
          const isNew = !lastRendered.includes(JSON.stringify(row));
          if (isNew) {
            tr.classList.add("new-entry");
            lastRendered.push(JSON.stringify(row));
          }
        }

        row.forEach((cell, colIndex) => {
          // Skip kolom ke-4 (index 3) - tidak dirender
          if (colIndex === 3) return;
          
          const el = document.createElement(index === 0 ? "th" : "td");
          
          // Kolom ke-1 (index 0) hanya tampilkan tanggal saja (tanpa waktu)
          if (index !== 0 && colIndex === 0 && isDateString(cell)) {
            el.textContent = formatDateOnly(cell);
          } else if (index !== 0 && colIndex === 2) {
            el.textContent = formatRibuan(cell);
          } else {
            el.textContent = cell;
          }
          tr.appendChild(el);
        });

        index === 0 ? thead.appendChild(tr) : tbody.appendChild(tr);
      });
    }

    function renderPagination(totalPages) {
      let wrap = document.getElementById("paginationWrap");
      if (!wrap) {
        wrap = document.createElement("div");
        wrap.id = "paginationWrap";
        wrap.className = "pagination";
        document.querySelector(".card").appendChild(wrap);
      }

      wrap.innerHTML = `
        <button id="prevBtn">‚Üê Prev</button>
        <span>Hal ${currentPage} / ${totalPages}</span>
        <button id="nextBtn">Next ‚Üí</button>
      `;

      const prev = document.getElementById("prevBtn");
      const next = document.getElementById("nextBtn");

      prev.disabled = currentPage === 1;
      next.disabled = currentPage === totalPages;

      prev.onclick = () => { currentPage--; renderTable(); };
      next.onclick = () => { currentPage++; renderTable(); };
    }

    document.getElementById("searchInput").addEventListener("input", () => {
      currentPage = 1;
      renderTable();
    });

    fetchData();
    setInterval(fetchData, 5000);
  </script>
</body>
</html>
